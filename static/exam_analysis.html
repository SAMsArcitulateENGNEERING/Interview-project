<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Analysis - Interview Program</title>
    <link rel="stylesheet" href="/static/css/style.css?v=3">
    <style>
        :root { --bg:#0f172a; --surface:#111827; --border:#1f2937; --text:#e5e7eb; --muted:#94a3b8; --primary:#2563eb; --success:#16a34a; --danger:#ef4444; --shadow:0 8px 30px rgba(0,0,0,0.35); }
        body { background: var(--bg); }
        .analysis-container { max-width: 1100px; margin: 0 auto; padding: 24px 16px; }
        .header-card { background: var(--surface); border:1px solid var(--border); border-radius: 14px; padding: 20px; box-shadow: var(--shadow); margin-bottom: 16px; display:flex; justify-content:space-between; align-items:center; }
        .header-card h1 { margin:0; font-size: 1.6rem; color: var(--text); }
        .back-button { background: var(--primary); color:#fff; padding: 10px 14px; border:none; border-radius:10px; text-decoration:none; font-weight:800; }
        .stats-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 14px; margin-bottom: 16px; }
        .stat-card { background: var(--surface); border:1px solid var(--border); border-radius: 12px; padding: 16px; text-align:center; box-shadow: var(--shadow); }
        .stat-value { font-size: 1.6rem; font-weight:900; color: var(--primary); margin-bottom: 4px; }
        .stat-label { color: var(--muted); font-size: 0.9rem; }
        .questions-container { background: var(--surface); border:1px solid var(--border); border-radius: 12px; box-shadow: var(--shadow); }
        .questions-header { padding: 16px; border-bottom:1px solid var(--border); font-weight:900; color: var(--text); }
        .question-item { border-bottom:1px solid var(--border); padding: 16px; }
        .question-item:last-child { border-bottom:none; }
        .question-header { display:flex; justify-content:space-between; align-items:center; margin-bottom: 10px; }
        .question-number { background: var(--primary); color:#fff; padding: 4px 10px; border-radius: 999px; font-weight:900; }
        .question-status { padding: 4px 10px; border-radius: 999px; font-weight:800; font-size: 0.85rem; }
        .status-correct { background:#064e3b; color:#d1fae5; border:1px solid #10b981; }
        .status-incorrect { background:#3f1d1d; color:#fecaca; border:1px solid #ef4444; }
        .question-text { font-size: 1.05rem; color: var(--text); margin-bottom: 10px; }
        .answer-details { display:grid; grid-template-columns:1fr 1fr; gap: 12px; }
        .answer-section { background:#0b1220; border:1px solid var(--border); border-radius: 8px; padding: 12px; }
        .answer-section h4 { margin:0 0 6px 0; color: var(--muted); font-size: 0.85rem; text-transform:uppercase; letter-spacing:0.4px; }
        .answer-text { font-weight:800; color: var(--text); }
        .time-info { margin-top: 10px; background:#0b255f; color:#cde3ff; border:1px solid #1e3a8a; border-radius:8px; padding: 10px; text-align:center; font-weight:800; }
        .loading { text-align:center; padding: 40px; color: var(--muted); }
        .error { background:#3f1d1d; color:#fecaca; border:1px solid #ef4444; padding: 12px; border-radius:10px; margin: 12px 0; }
    </style>
</head>
<body>
    <div class="analysis-container">
        <div class="header-card">
            <h1>üìä Exam Analysis</h1>
            <a href="/host.html" class="back-button">‚Üê Back to Host Dashboard</a>
        </div>
        
        <div id="loading" class="loading"><h2>Loading exam analysis...</h2></div>
        <div id="error" class="error" style="display:none;"><h3>Error</h3><p id="error-message"></p></div>

        <div id="analysis-content" style="display:none;">
            <div class="header-card" style="margin-bottom:16px;">
                <p id="user-info" style="margin:0;color:var(--muted);"></p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-value" id="score">-</div><div class="stat-label">Score</div></div>
                <div class="stat-card"><div class="stat-value" id="total-questions">-</div><div class="stat-label">Total Questions</div></div>
                <div class="stat-card"><div class="stat-value" id="duration">-</div><div class="stat-label">Total Duration</div></div>
                <div class="stat-card"><div class="stat-value" id="avg-time">-</div><div class="stat-label">Avg Time per Question</div></div>
                <div class="stat-card"><div class="stat-value" id="violations">-</div><div class="stat-label">Violations</div></div>
            </div>
            
            <div class="questions-container">
                <div class="questions-header">üìù Question-by-Question Breakdown</div>
                <div id="questions-list"></div>
            </div>
        </div>
    </div>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const attemptId = urlParams.get('attempt_id');
        if (!attemptId) { showError('No exam attempt ID provided'); } else { loadExamAnalysis(attemptId); }
        
        async function loadExamAnalysis(attemptId) {
            try {
                const response = await fetch(`/get_exam_analysis/${attemptId}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const analysis = await response.json();
                displayAnalysis(analysis);
            } catch (error) {
                console.error('Error loading exam analysis:', error);
                showError('Failed to load exam analysis. Please try again.');
            }
        }
        
        function displayAnalysis(analysis) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('analysis-content').style.display = 'block';
            document.getElementById('user-info').textContent = `${analysis.user_name} (${analysis.user_email}) ‚Äî Attempt #${analysis.attempt_id}`;
            document.getElementById('score').textContent = `${analysis.score}/${analysis.total_questions}`;
            document.getElementById('total-questions').textContent = analysis.total_questions;
            document.getElementById('duration').textContent = analysis.duration_formatted;
            document.getElementById('avg-time').textContent = analysis.average_time_formatted;
            document.getElementById('violations').textContent = analysis.alt_tab_count;
            const questionsList = document.getElementById('questions-list');
            questionsList.innerHTML = '';
            analysis.detailed_questions.forEach((question, index) => {
            const div = document.createElement('div');
            div.className = 'question-item';
            const statusClass = question.is_correct ? 'status-correct' : 'status-incorrect';
            const statusText = question.is_correct ? '‚úì Correct' : '‚úó Incorrect';
            div.innerHTML = `
                <div class="question-header">
                        <span class="question-number">Question ${index + 1}</span>
                    <span class="question-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="question-text">${question.question_text}</div>
                    <div class="answer-details">
                        <div class="answer-section"><h4>User's Answer</h4><div class="answer-text">${question.user_answer || 'Not answered'}</div></div>
                        <div class="answer-section"><h4>Correct Answer</h4><div class="answer-text">${question.correct_answer}</div></div>
                    </div>
                    <div class="time-info">‚è±Ô∏è Time taken: ${question.time_taken_formatted}</div>
                `;
                questionsList.appendChild(div);
            });
        }
        
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error-message').textContent = message;
        }
    </script>
</body>
</html> 